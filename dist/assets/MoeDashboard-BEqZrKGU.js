var m=Object.defineProperty;var u=(r,a,t)=>a in r?m(r,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[a]=t;var i=(r,a,t)=>(u(r,typeof a!="symbol"?a+"":a,t),t);import{u as b,b as j,a as p,r as c,g as v,c as f,j as e,d as y}from"./index-CwYS-J06.js";class N extends c.Component{constructor(){super(...arguments);i(this,"state",{error:null})}static getDerivedStateFromError(t){return console.error("MoeDashboard.jsx - ErrorBoundary caught:",t,t.stack),{error:t}}render(){return this.state.error?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 text-gray-900",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md w-full text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Something Went Wrong"}),e.jsx("p",{className:"text-red-600 mb-6",children:this.state.error.message||"An unexpected error occurred"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Reload Page"})]})}):this.props.children}}const M=()=>{const{user:r,loading:a,logout:t}=b()||{user:null,loading:!0},o=j(),n=p(),[d]=c.useState(new Date);c.useEffect(()=>{if(console.log("MoeDashboard.jsx - useEffect - user:",r,"loading:",a,"location:",n.pathname),!a)if(!r)console.log("MoeDashboard.jsx - No user, redirecting to /system"),o("/system",{replace:!0});else try{const s=v(r.securityLevel);n.pathname==="/moe/dashboard"&&(console.log(`MoeDashboard.jsx - Redirecting to ${s} for ${r.securityLevel}`),o(s,{replace:!0}))}catch(s){console.error("MoeDashboard.jsx - Navigation error:",s)}},[r,a,o,n.pathname]);let l=[];try{l=f(r==null?void 0:r.securityLevel),console.log("MoeDashboard.jsx - Available items:",l)}catch(s){console.error("MoeDashboard.jsx - Error fetching available items:",s)}const x=s=>{console.log("MoeDashboard.jsx - Navigating to:",s),o(s)},h=s=>{try{return s.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}catch(g){return console.error("MoeDashboard.jsx - Error formatting date:",g),"Date unavailable"}};return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-gray-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Loading..."})]})}):r?e.jsx(N,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("img",{src:"/logos/moe.png",alt:"MOE Logo",className:"w-16 h-16",onError:s=>{console.error("MoeDashboard.jsx - Failed to load MOE logo"),s.target.src="https://via.placeholder.com/64?text=MOE"}}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:["Welcome, ",r.username||"User"]}),e.jsx("p",{className:"text-gray-600",children:h(d)})]})]}),e.jsx("button",{onClick:()=>{console.log("MoeDashboard.jsx - Logging out:",r),t(),o("/system",{replace:!0})},className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Logout"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.length>0?l.map(s=>e.jsx("div",{onClick:()=>x(s.path),className:"bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"text-3xl p-3 bg-blue-100 text-blue-600 rounded-full",children:s.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:s.title}),e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-600 text-white rounded-full",children:y(s.requiredLevel)})]})]})},s.id)):e.jsx("p",{className:"text-gray-600",children:"No tools available for your role."})})]})})}):null};export{M as default};
